<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ DASHBOARD APODERADO ULTRA VISIBLE - SAM</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* ESTILOS ULTRA VISIBLES PARA CONFIRMAR FUNCIONAMIENTO */
        
        body {
            background: linear-gradient(45deg, #FFE5E5, #E5E5FF, #E5FFE5) !important;
            font-family: 'Arial', sans-serif !important;
            min-height: 100vh !important;
        }
        
        /* MENSAJE ULTRA VISIBLE PARA CONFIRMAR CAMBIOS */
        .mensaje-ultra-visible {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            background: linear-gradient(45deg, #FF0000, #00FF00, #0000FF) !important;
            color: #FFFFFF !important;
            font-size: 48px !important;
            font-weight: bold !important;
            text-align: center !important;
            padding: 2rem !important;
            border: 10px solid #FFFF00 !important;
            border-radius: 20px !important;
            z-index: 999999 !important;
            box-shadow: 0 0 50px rgba(255,255,255,0.8) !important;
            animation: parpadeo 0.5s infinite alternate !important;
        }
        
        @keyframes parpadeo {
            0% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        /* ESTILOS PARA SELECTOR DE ESTUDIANTES ULTRA VISIBLES */
        .estudiante-selector {
            background: linear-gradient(135deg, #FF0000, #AA0000) !important;
            color: white !important;
            font-weight: bold !important;
            font-size: 20px !important;
            border: 6px solid #000000 !important;
            border-radius: 20px !important;
            transform: scale(1.1) !important;
            box-shadow: 0 20px 50px rgba(255,0,0,0.8) !important;
            transition: all 0.3s ease !important;
            min-height: 160px !important;
            padding: 1.5rem !important;
            margin: 1rem !important;
            cursor: pointer !important;
        }
        
        .estudiante-selector:hover {
            background: linear-gradient(135deg, #FF3333, #CC0000) !important;
            transform: scale(1.2) !important;
            box-shadow: 0 25px 60px rgba(255,0,0,0.9) !important;
        }
        
        .estudiante-selector.active {
            background: linear-gradient(135deg, #0000FF, #000088) !important;
            color: yellow !important;
            border: 6px solid #FFFF00 !important;
            transform: scale(1.25) !important;
            box-shadow: 0 30px 70px rgba(0,0,255,0.9) !important;
        }
        
        .estudiante-selector * {
            color: inherit !important;
            font-weight: bold !important;
            font-size: 18px !important;
        }
        
        .estudiante-selector.active * {
            color: yellow !important;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8) !important;
        }
        
        /* Estilos para las tarjetas de estad√≠sticas */
        .apoderado-stat-card {
            border-radius: 15px !important;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
            transition: all 0.4s ease !important;
            overflow: hidden !important;
            margin-bottom: 1rem !important;
            min-height: 120px !important;
        }
        
        .apoderado-stat-card:hover {
            transform: translateY(-8px) scale(1.03) !important;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3) !important;
        }
        
        .title-ultra {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4) !important;
            color: white !important;
            padding: 2rem !important;
            text-align: center !important;
            font-size: 2.5rem !important;
            font-weight: bold !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;
            margin-bottom: 2rem !important;
            border-radius: 20px !important;
        }
        
        .container-ultra {
            padding: 2rem !important;
            max-width: 1400px !important;
        }
        
        .estudiante-panel {
            background: rgba(255,255,255,0.9) !important;
            border-radius: 20px !important;
            padding: 2rem !important;
            margin: 1rem 0 !important;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1) !important;
        }
    </style>
</head>
<body>
    <div class="container-ultra">
        <div class="title-ultra">
            üéØ DASHBOARD APODERADO ULTRA VISIBLE
        </div>
        
        <!-- Mensaje de confirmaci√≥n que se oculta despu√©s de 5 segundos -->
        <div class="mensaje-ultra-visible" id="mensajeConfirmacion">
            üéØ TEMPLATE FUNCIONANDO<br>
            Los cambios se est√°n aplicando!
        </div>
        
        {% if estudiantes %}
        <div class="row mb-4">
            <div class="col-12">
                <h2 style="color: #0000FF; font-size: 32px; font-weight: bold; text-align: center;">
                    üë• Seleccionar Estudiante:
                </h2>
            </div>
            {% for estudiante in estudiantes %}
            <div class="col-md-4 mb-3">
                <div class="estudiante-selector" data-estudiante-id="{{ estudiante.id }}" {% if forloop.first %}data-active="true"{% endif %}>
                    <div class="text-center">
                        <i class="fas fa-user-graduate fa-3x mb-3"></i>
                        <h3>{{ estudiante.nombre }} {{ estudiante.apellido }}</h3>
                        <p><strong>Curso:</strong> {{ estudiante.curso|default:"Sin curso" }}</p>
                        <p><strong>RUT:</strong> {{ estudiante.rut }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Paneles de informaci√≥n por estudiante -->
        {% for estudiante in estudiantes %}
        <div id="panel-estudiante-{{ estudiante.id }}" class="estudiante-panel" style="{% if not forloop.first %}display: none;{% endif %}">
            <div class="row">
                <div class="col-12">
                    <h2 style="color: #008800; font-size: 36px; font-weight: bold; text-align: center;">
                        üìä Informaci√≥n de {{ estudiante.nombre }} {{ estudiante.apellido }}
                    </h2>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="apoderado-stat-card" style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 1.5rem; text-align: center;">
                        <i class="fas fa-book fa-3x mb-3"></i>
                        <h4>üìö Asignaturas</h4>
                        <h2>{{ estudiante.asignaturas_count|default:"0" }}</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="apoderado-stat-card" style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; padding: 1.5rem; text-align: center;">
                        <i class="fas fa-clipboard-list fa-3x mb-3"></i>
                        <h4>üìù Evaluaciones</h4>
                        <h2>{{ estudiante.evaluaciones_count|default:"0" }}</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="apoderado-stat-card" style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 1.5rem; text-align: center;">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h4>üìä Promedio</h4>
                        <h2>{{ estudiante.promedio_general|floatformat:1|default:"N/A" }}</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="apoderado-stat-card" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); color: white; padding: 1.5rem; text-align: center;">
                        <i class="fas fa-calendar-check fa-3x mb-3"></i>
                        <h4>üìã Asistencia</h4>
                        <h2>{{ estudiante.porcentaje_asistencia|floatformat:1|default:"N/A" }}%</h2>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <div class="alert alert-success" style="font-size: 18px; font-weight: bold;">
                        ‚úÖ Panel del estudiante {{ estudiante.nombre }} {{ estudiante.apellido }} cargado correctamente.
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="row">
            <div class="col-12">
                <div class="alert alert-warning" style="font-size: 24px; font-weight: bold; background: #FFD700; color: #8B4513; text-align: center;">
                    ‚ö†Ô∏è No hay estudiantes asociados a este apoderado.
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Informaci√≥n del apoderado -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px;">
                    <div class="card-body" style="padding: 2rem;">
                        <h3><i class="fas fa-user-friends"></i> Informaci√≥n del Apoderado</h3>
                        {% if apoderado %}
                        <p><strong>Nombre:</strong> {{ apoderado }}</p>
                        <p><strong>Total de estudiantes:</strong> {{ total_estudiantes|default:"0" }}</p>
                        {% endif %}
                        <p><strong>Usuario:</strong> {{ user.username }}</p>
                        <p><strong>Tipo:</strong> {{ tipo_usuario|default:"apoderado" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        console.log("üö® TEMPLATE ULTRA VISIBLE CARGADO - SI VES ESTO, LOS CAMBIOS SE EST√ÅN APLICANDO üö®");
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üéØ JavaScript del template ultra visible ejecut√°ndose");
            
            // Ocultar mensaje despu√©s de 5 segundos
            setTimeout(() => {
                const mensaje = document.getElementById('mensajeConfirmacion');
                if (mensaje) {
                    mensaje.style.display = 'none';
                }
            }, 5000);
            
            // Configurar selector de estudiantes
            const selectores = document.querySelectorAll('.estudiante-selector');
            console.log(`üìã Encontrados ${selectores.length} selectores de estudiantes`);
            
            selectores.forEach((selector, index) => {
                console.log(`üéØ Configurando selector ${index + 1}`);
                
                selector.addEventListener('click', function() {
                    console.log(`üéØ Selector ${index + 1} clickeado`);
                    
                    // Remover clase active de todos
                    selectores.forEach(s => s.classList.remove('active'));
                    
                    // Agregar clase active al clickeado
                    this.classList.add('active');
                    
                    // Mostrar panel correspondiente
                    const estudianteId = this.getAttribute('data-estudiante-id');
                    console.log(`üìä Mostrando informaci√≥n del estudiante: ${estudianteId}`);
                    
                    // Ocultar todos los paneles
                    const paneles = document.querySelectorAll('.estudiante-panel');
                    paneles.forEach(panel => {
                        panel.style.display = 'none';
                    });
                    
                    // Mostrar panel correspondiente
                    const panelActivo = document.getElementById(`panel-estudiante-${estudianteId}`);
                    if (panelActivo) {
                        panelActivo.style.display = 'block';
                        console.log(`‚úÖ Panel del estudiante ${estudianteId} mostrado`);
                    } else {
                        console.error(`‚ùå No se encontr√≥ panel para estudiante ${estudianteId}`);
                    }
                });
            });
            
            // Activar primer estudiante por defecto si hay selectores
            if (selectores.length > 0) {
                const primerSelector = selectores[0];
                primerSelector.classList.add('active');
                console.log("‚úÖ Primer estudiante activado por defecto");
            }
        });
    </script>
</body>
</html>
