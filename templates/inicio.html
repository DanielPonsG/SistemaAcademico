{% extends "index_master.html" %}

{% block extra_css %}
<style>
/* Estilos específicos para el panel de profesores */
.quick-access-card {
  transition: all 0.3s ease;
  background: #f8f9fa;
  border: 1px solid #dee2e6;
}

.quick-access-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  background: #ffffff;
}

.stats-card {
  transition: transform 0.2s ease;
}

.stats-card:hover {
  transform: scale(1.05);
}

.academic-section {
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

.section-title {
  border-bottom: 2px solid #e9ecef;
  padding-bottom: 0.5rem;
}

.clase-bloque {
  font-size: 0.75rem;
  line-height: 1.2;
  padding: 2px;
  border-radius: 3px;
  background: rgba(13, 110, 253, 0.1);
  border-left: 3px solid #0d6efd;
}

.tabla-horarios {
  font-size: 0.85rem;
}

.horario-cell {
  width: 120px;
  max-width: 120px;
  word-wrap: break-word;
  vertical-align: middle;
}

.hora-columna {
  background-color: #f8f9fa;
  font-weight: 600;
  color: #495057;
}

/* Estilos para el panel de profesor */
.profesor-stats-card {
  transition: all 0.3s ease;
}

.profesor-stats-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.profesor-info-item {
  padding: 0.75rem;
  border-radius: 6px;
  background: #f8f9fa;
  margin-bottom: 0.5rem;
}

.annotation-item {
  transition: background-color 0.2s ease;
}

.annotation-item:hover {
  background-color: #f8f9fa;
}

/* Estilos para el panel de administradores */
.admin-stats-card {
  transition: all 0.3s ease;
}

.admin-stats-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.admin-item {
  transition: background-color 0.2s ease;
  border-radius: 6px;
}

.admin-item:hover {
  background-color: #f8f9fa;
}

/* Responsive para paneles de profesor */
@media (max-width: 768px) {
  .quick-access-card {
    margin-bottom: 1rem;
  }
  
  .profesor-stats-card .card-body,
  .admin-stats-card .card-body {
    padding: 1rem;
  }
  
  .profesor-stats-card h3,
  .admin-stats-card h3 {
    font-size: 1.5rem;
  }
}

/* Animaciones suaves */
.fade-in {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}

{% block content %}
<div class="right_col" role="main">
  <div class="container-fluid">
    <!-- Header de bienvenida -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="bg-white p-4 rounded shadow-sm border">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <i class="fas fa-user-circle fa-3x text-primary"></i>
                </div>
                <div>
                  <h1 class="h3 mb-1 text-dark">¡Bienvenido, {{ user.first_name|default:user.username }}!</h1>
                  <p class="mb-0 text-muted">
                    <i class="fas fa-id-badge me-2"></i>
                    Tipo de usuario: <span class="badge bg-primary text-white px-2 py-1">{{ user.perfil.get_tipo_usuario_display }}</span>
                  </p>
                </div>
              </div>
            </div>
            <div class="col-md-4 text-end d-none d-md-block">
              <div class="text-center">
                <i class="fas fa-calendar-alt fa-2x text-muted mb-2"></i>
                <p class="mb-0 small text-muted" id="currentDateTime"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if user.perfil.tipo_usuario == 'alumno' %}
    <!-- ################################################## -->
    <!-- ########## PANEL SIMPLIFICADO PARA ESTUDIANTES ######### -->
    <!-- ################################################## -->
    <div class="row">
      <!-- Panel Principal: Resumen Académico -->
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h4 class="mb-0 text-dark"><i class="fas fa-graduation-cap text-primary me-2"></i>Mi Información Académica</h4>
          </div>
          <div class="card-body">
            {% if estudiante %}
              <!-- Información básica del curso -->
              {% if curso_actual %}
              <div class="alert alert-primary mb-4">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <h5 class="mb-1"><i class="fas fa-university me-2"></i>{{ curso_actual.get_nivel_display }}{{ curso_actual.paralelo }}</h5>
                    <p class="mb-0">
                      <strong>Profesor Jefe:</strong> {{ curso_actual.profesor_jefe.get_nombre_completo|default:"No asignado" }}
                      <br><strong>Año Académico:</strong> {{ curso_actual.anio }}
                    </p>
                  </div>
                  <div class="col-md-4 text-end">
                    <i class="fas fa-school fa-3x text-primary opacity-25"></i>
                  </div>
                </div>
              </div>
              {% endif %}

              <!-- Estadísticas académicas principales -->
              <div class="row mb-5 academic-section">
                <div class="col-md-3 mb-3">
                  <div class="text-center p-3 bg-light rounded stats-card">
                    <i class="fas fa-trophy fa-2x text-warning mb-2"></i>
                    <h4 class="mb-1">{{ promedio_general|default:"--" }}</h4>
                    <small class="text-muted">Promedio</small>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="text-center p-3 bg-light rounded stats-card">
                    <i class="fas fa-calendar-check fa-2x text-success mb-2"></i>
                    <h4 class="mb-1">{{ porcentaje_asistencia|default:"0" }}%</h4>
                    <small class="text-muted">Asistencia</small>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="text-center p-3 bg-light rounded stats-card">
                    <i class="fas fa-book fa-2x text-info mb-2"></i>
                    <h4 class="mb-1">{{ asignaturas.count|default:"0" }}</h4>
                    <small class="text-muted">Materias</small>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="text-center p-3 bg-light rounded stats-card">
                    <i class="fas fa-sticky-note fa-2x text-secondary mb-2"></i>
                    <h4 class="mb-1">{{ anotaciones_recientes.count|default:"0" }}</h4>
                    <small class="text-muted">Anotaciones</small>
                  </div>
                </div>
              </div>

              <!-- Horario Semanal -->
              <div class="academic-section">
                <h5 class="text-dark mb-4 section-title"><i class="fas fa-calendar-week me-2"></i>Mi Horario de Clases</h5>
              {% if proximos_horarios %}
                <!-- Vista de próximos días (solo los siguientes 3 días) -->
                <div class="mb-4">
                  <h6 class="text-muted mb-3"><i class="fas fa-clock me-1"></i>Próximas Clases</h6>
                  <div class="row g-2">
                    {% for dia in proximos_horarios %}
                    <div class="col-md-4">
                      <div class="card border h-100">
                        <div class="card-header bg-light py-2">
                          <h6 class="mb-0 text-primary">{{ dia.dia_nombre }}</h6>
                          <small class="text-muted">{{ dia.fecha|date:"d/m/Y" }}</small>
                        </div>
                        <div class="card-body py-2">
                          {% for horario in dia.horarios|slice:":4" %}
                            <div class="d-flex justify-content-between small mb-1">
                              <div>
                                <strong>{{ horario.asignatura.nombre|truncatechars:18 }}</strong>
                                {% if horario.asignatura.profesor_responsable %}
                                  <br><small class="text-muted">{{ horario.asignatura.profesor_responsable.get_nombre_completo|truncatechars:20 }}</small>
                                {% endif %}
                              </div>
                              <div class="text-end">
                                <span class="text-muted">{{ horario.hora_inicio|time:"H:i" }}</span>
                                <br><small class="text-muted">{{ horario.hora_fin|time:"H:i" }}</small>
                              </div>
                            </div>
                            {% if not forloop.last %}<hr class="my-1">{% endif %}
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>

                <!-- Horario completo de la semana -->
                {% if curso_actual and horario_semanal_completo %}
                <div class="mb-4">
                  <h6 class="text-muted mb-3"><i class="fas fa-table me-1"></i>Horario Semanal Completo - {{ curso_actual.get_nivel_display }}{{ curso_actual.paralelo }}</h6>
                  <div class="table-responsive">
                    <table class="table table-sm table-bordered tabla-horarios">
                      <thead class="table-light">
                        <tr>
                          <th class="text-center" style="width: 100px;">Hora</th>
                          <th class="text-center horario-cell">Lunes</th>
                          <th class="text-center horario-cell">Martes</th>
                          <th class="text-center horario-cell">Miércoles</th>
                          <th class="text-center horario-cell">Jueves</th>
                          <th class="text-center horario-cell">Viernes</th>
                          <th class="text-center horario-cell">Sábado</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for hora in horas_disponibles %}
                        <tr>
                          <td class="text-center hora-columna">{{ hora }}</td>
                          {% for dia_num in "123456"|make_list %}
                            <td class="text-center align-middle horario-cell" style="height: 60px;">
                              {% for dia_horario in horario_semanal_completo %}
                                {% if dia_horario.dia_numero == dia_num|add:0 %}
                                  {% for clase in dia_horario.horarios %}
                                    {% if clase.hora_inicio|time:"H:i" == hora %}
                                      <div class="clase-bloque">
                                        <strong>{{ clase.asignatura.nombre|truncatechars:12 }}</strong>
                                        {% if clase.asignatura.profesor_responsable %}
                                          <small>{{ clase.asignatura.profesor_responsable.primer_nombre }}</small>
                                        {% endif %}
                                      </div>
                                    {% endif %}
                                  {% endfor %}
                                {% endif %}
                              {% endfor %}
                            </td>
                          {% endfor %}
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="text-center mt-2">
                    <a href="{% url 'mis_horarios' %}" class="btn btn-outline-primary btn-sm">
                      <i class="fas fa-calendar-alt me-1"></i>Ver Horario Completo
                    </a>
                  </div>
                </div>
                {% elif curso_actual %}
                <div class="alert alert-info text-center mb-4">
                  <i class="fas fa-info-circle me-2"></i>No hay horarios programados para tu curso.
                  <br><small class="text-muted">Curso: {{ curso_actual.get_nivel_display }}{{ curso_actual.paralelo }}</small>
                </div>
                {% endif %}
              {% else %}
                <div class="alert alert-info text-center mb-4">
                  <i class="fas fa-info-circle me-2"></i>No hay horarios programados disponibles.
                  {% if curso_actual %}
                    <br><small class="text-muted">Curso: {{ curso_actual.get_nivel_display }}{{ curso_actual.paralelo }}</small>
                  {% endif %}
                </div>
              {% endif %}

              <!-- Accesos Rápidos Académicos -->
              <div class="academic-section">
                <h5 class="text-dark mb-4 section-title"><i class="fas fa-rocket me-2"></i>Mis Recursos Académicos</h5>
                <div class="row g-4">
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'ver_notas_curso' %}" class="text-decoration-none">
                      <div class="card border-0 bg-primary text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mis Notas</h6>
                        <small class="opacity-75">Ver calificaciones y evaluaciones</small>
                      </div>
                    </a>
                  </div>
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'ver_asistencia_alumno' %}" class="text-decoration-none">
                      <div class="card border-0 bg-success text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-user-check fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mi Asistencia</h6>
                        <small class="opacity-75">Revisar registro de asistencia</small>
                      </div>
                    </a>
                  </div>
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'mis_horarios' %}" class="text-decoration-none">
                      <div class="card border-0 bg-info text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-clock fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mi Horario</h6>
                        <small class="opacity-75">Ver horario completo de clases</small>
                      </div>
                    </a>
                  </div>
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'mi_curso' %}" class="text-decoration-none">
                      <div class="card border-0 bg-warning text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-users fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mi Curso</h6>
                        <small class="opacity-75">Información del curso y compañeros</small>
                      </div>
                    </a>
                  </div>
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'listar_asignaturas' %}" class="text-decoration-none">
                      <div class="card border-0 bg-secondary text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-book fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mis Materias</h6>
                        <small class="opacity-75">Ver asignaturas y profesores</small>
                      </div>
                    </a>
                  </div>
                  <div class="col-lg-4 col-md-6 mb-3">
                    <a href="{% url 'libro_anotaciones' %}" class="text-decoration-none">
                      <div class="card border-0 bg-danger text-white text-center p-4 h-100 quick-access-card">
                        <i class="fas fa-sticky-note fa-3x mb-3"></i>
                        <h6 class="mb-1 fw-bold">Mis Anotaciones</h6>
                        <small class="opacity-75">Revisar observaciones académicas</small>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

            {% elif error_estudiante %}
              <div class="alert alert-danger text-center">
                <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h5>
                <p>{{ error_estudiante }}</p>
                <p class="mb-0">Por favor, contacta con el administrador para resolver este problema.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Panel Lateral: Anotaciones y Asignaturas -->
      <div class="col-lg-4 mb-4">
        <!-- Anotaciones Recientes -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark"><i class="fas fa-book-open text-warning me-2"></i>Anotaciones Recientes</h5>
          </div>
          <div class="card-body">
            {% if anotaciones_recientes %}
              <div class="list-group list-group-flush">
                {% for anotacion in anotaciones_recientes %}
                  <div class="list-group-item border-0 px-0">
                    <span class="badge bg-{% if anotacion.tipo == 'positiva' %}success{% elif anotacion.tipo == 'negativa' %}danger{% else %}warning{% endif %} mb-1">
                      {{ anotacion.get_tipo_display }}
                    </span>
                    <p class="mb-1 small">{{ anotacion.descripcion|truncatewords:10 }}</p>
                    <small class="text-muted">{{ anotacion.fecha_creacion|date:"d/m/Y" }}</small>
                  </div>
                {% endfor %}
              </div>
              <div class="text-center mt-3">
                <a href="{% url 'libro_anotaciones' %}" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-eye me-1"></i>Ver Todas
                </a>
              </div>
            {% else %}
              <div class="alert alert-success text-center">
                <i class="fas fa-thumbs-up fa-2x mb-2"></i>
                <p class="mb-0">¡Felicidades! No tienes anotaciones recientes.</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Mis Asignaturas -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark"><i class="fas fa-book text-info me-2"></i>Mis Asignaturas</h5>
          </div>
          <div class="card-body">
            {% if asignaturas_con_profesores %}
              <div class="list-group list-group-flush">
                {% for item in asignaturas_con_profesores|slice:":5" %}
                  <div class="list-group-item border-0 px-0">
                    <h6 class="mb-1">{{ item.asignatura.nombre }}</h6>
                    <small class="text-muted">
                      {% if item.profesor %}
                        <i class="fas fa-user me-1"></i>{{ item.profesor.get_nombre_completo }}
                      {% else %}
                        <i class="fas fa-user-times me-1"></i>Sin profesor asignado
                      {% endif %}
                    </small>
                  </div>
                {% endfor %}
              </div>
              {% if asignaturas_con_profesores.count > 5 %}
                <div class="text-center mt-3">
                  <a href="{% url 'listar_asignaturas' %}" class="btn btn-outline-info btn-sm">
                    <i class="fas fa-eye me-1"></i>Ver Todas ({{ asignaturas_con_profesores.count }})
                  </a>
                </div>
              {% endif %}
            {% else %}
              <div class="text-center">
                <i class="fas fa-book fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No tienes asignaturas asignadas</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% elif user.perfil.tipo_usuario == 'profesor' %}
    <!-- ################################################## -->
    <!-- ########### PANEL ESPECÍFICO PARA PROFESORES ############### -->
    <!-- ################################################## -->
    
    <!-- Estadísticas principales del profesor -->
    <div class="row mb-4 fade-in">
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-primary text-white h-100 profesor-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-users fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ total_estudiantes|default:"0" }}</h3>
            <small>Estudiantes a Cargo</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-success text-white h-100 profesor-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-book fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ asignaturas_profesor.count|default:"0" }}</h3>
            <small>Asignaturas Asignadas</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-warning text-white h-100 profesor-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-school fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ cursos_con_asignaturas.count|default:"0" }}</h3>
            <small>Cursos Asignados</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-info text-white h-100 profesor-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-sticky-note fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ stats_anotaciones.total|default:"0" }}</h3>
            <small>Anotaciones Creadas</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de accesos rápidos para profesores -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h4 class="mb-0 text-dark">
              <i class="fas fa-rocket text-primary me-2"></i>Herramientas Principales
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'crear_anotacion' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-plus-circle fa-2x text-success mb-2"></i>
                    <h6 class="mb-0">Crear Anotación</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'libro_anotaciones' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-book-open fa-2x text-primary mb-2"></i>
                    <h6 class="mb-0">Libro de Anotaciones</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_cursos' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-users fa-2x text-warning mb-2"></i>
                    <h6 class="mb-0">Mis Cursos</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_asignaturas' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-book fa-2x text-info mb-2"></i>
                    <h6 class="mb-0">Mis Asignaturas</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'ver_notas_curso' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-chart-line fa-2x text-secondary mb-2"></i>
                    <h6 class="mb-0">Ver Notas</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'calendario' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-calendar-alt fa-2x text-danger mb-2"></i>
                    <h6 class="mb-0">Calendario</h6>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel principal del profesor -->
    <div class="row">
      <!-- Información académica -->
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-chalkboard-teacher text-primary me-2"></i>Mi Panel Académico
            </h5>
          </div>
          <div class="card-body">
            {% if profesor %}
            
            <!-- Cursos como jefe de curso -->
            {% if cursos_jefe %}
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-user-tie me-1"></i>Jefatura de Curso
              </h6>
              <div class="row g-2">
                {% for curso in cursos_jefe %}
                <div class="col-md-6">
                  <div class="card border">
                    <div class="card-body p-3">
                      <h6 class="mb-2">{{ curso.get_nivel_display }}{{ curso.paralelo }}</h6>
                      <p class="mb-1 small text-muted">
                        <i class="fas fa-users me-1"></i>{{ curso.estudiantes.count }} estudiantes
                      </p>
                      <div class="d-flex gap-2">
                        <a href="{% url 'listar_cursos' %}#curso-{{ curso.id }}" class="btn btn-outline-primary btn-sm">
                          <i class="fas fa-eye me-1"></i>Ver
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <!-- Asignaturas que enseña -->
            {% if asignaturas_profesor %}
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-book me-1"></i>Mis Asignaturas ({{ asignaturas_profesor.count }})
              </h6>
              <div class="row g-2">
                {% for asignatura in asignaturas_profesor|slice:":6" %}
                <div class="col-md-4">
                  <div class="card border h-100">
                    <div class="card-body p-2 text-center">
                      <h6 class="mb-1 small">{{ asignatura.nombre|truncatechars:20 }}</h6>
                      <small class="text-muted">{{ asignatura.codigo|default:"Sin código" }}</small>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% if asignaturas_profesor.count > 6 %}
              <div class="text-center mt-2">
                <a href="{% url 'listar_asignaturas' %}" class="btn btn-outline-info btn-sm">
                  <i class="fas fa-eye me-1"></i>Ver Todas ({{ asignaturas_profesor.count }})
                </a>
              </div>
              {% endif %}
            </div>
            {% endif %}

            <!-- Próximos horarios del profesor -->
            {% if proximos_horarios_profesor %}
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-clock me-1"></i>Mis Próximas Clases
              </h6>
              <div class="row g-2">
                {% for dia in proximos_horarios_profesor %}
                <div class="col-md-4">
                  <div class="card border h-100">
                    <div class="card-header bg-light py-2">
                      <h6 class="mb-0 text-primary small">{{ dia.dia_nombre }}</h6>
                      <small class="text-muted">{{ dia.fecha|date:"d/m" }}</small>
                    </div>
                    <div class="card-body py-2">
                      {% for horario in dia.horarios|slice:":3" %}
                        <div class="d-flex justify-content-between small mb-1">
                          <div>
                            <strong>{{ horario.asignatura.nombre|truncatechars:15 }}</strong>
                            <br><small class="text-muted">{{ horario.curso.get_nivel_display }}{{ horario.curso.paralelo }}</small>
                          </div>
                          <div class="text-end">
                            <span class="text-muted">{{ horario.hora_inicio|time:"H:i" }}</span>
                          </div>
                        </div>
                        {% if not forloop.last %}<hr class="my-1">{% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <!-- Estadísticas de anotaciones -->
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-chart-pie me-1"></i>Resumen de Anotaciones
              </h6>
              <div class="row g-2">
                <div class="col-md-3">
                  <div class="text-center p-2 bg-success text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones.positivas }}</h6>
                    <small>Positivas</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-warning text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones.neutras }}</h6>
                    <small>Neutras</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-danger text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones.negativas }}</h6>
                    <small>Negativas</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-secondary text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones.total }}</h6>
                    <small>Total</small>
                  </div>
                </div>
              </div>
            </div>

            {% else %}
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              No se encontró información del profesor asociada a este usuario.
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Panel lateral -->
      <div class="col-lg-4 mb-4">
        <!-- Anotaciones recientes -->
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-header bg-light border-0">
            <h6 class="mb-0">
              <i class="fas fa-history text-info me-2"></i>Anotaciones Recientes
            </h6>
          </div>
          <div class="card-body">
            {% if anotaciones_recientes %}
              {% for anotacion in anotaciones_recientes|slice:":3" %}
              <div class="d-flex mb-2 p-2 rounded annotation-item {% if not forloop.last %}border-bottom pb-3{% endif %}">
                <div class="me-2">
                  {% if anotacion.tipo == 'positiva' %}
                    <i class="fas fa-thumbs-up text-success"></i>
                  {% elif anotacion.tipo == 'negativa' %}
                    <i class="fas fa-thumbs-down text-danger"></i>
                  {% else %}
                    <i class="fas fa-minus text-warning"></i>
                  {% endif %}
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1 small">
                    {% if anotacion.estudiante %}
                      {{ anotacion.estudiante.get_nombre_completo }}
                    {% else %}
                      {{ anotacion.curso.get_nivel_display }}{{ anotacion.curso.paralelo }} (General)
                    {% endif %}
                  </h6>
                  <p class="mb-0 small text-muted">{{ anotacion.contenido|truncatechars:60 }}</p>
                  <small class="text-muted">{{ anotacion.fecha_creacion|date:"d/m H:i" }}</small>
                </div>
              </div>
              {% endfor %}
              <div class="text-center mt-2">
                <a href="{% url 'libro_anotaciones' %}" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-eye me-1"></i>Ver Todas
                </a>
              </div>
            {% else %}
              <div class="text-center text-muted">
                <i class="fas fa-clipboard fa-2x mb-2"></i>
                <p class="mb-0 small">No hay anotaciones recientes</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Información personal -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h6 class="mb-0">
              <i class="fas fa-user text-secondary me-2"></i>Información Personal
            </h6>
          </div>
          <div class="card-body">
            <div class="mb-2 profesor-info-item">
              <small class="text-muted d-block">Nombre Completo</small>
              <p class="mb-0 fw-semibold">{{ user.get_full_name|default:user.username }}</p>
            </div>
            <div class="mb-2 profesor-info-item">
              <small class="text-muted d-block">Email</small>
              <p class="mb-0">{{ user.email|default:"No registrado" }}</p>
            </div>
            {% if profesor %}
            <div class="mb-2 profesor-info-item">
              <small class="text-muted d-block">RUT</small>
              <p class="mb-0">{{ profesor.rut|default:"No registrado" }}</p>
            </div>
            {% endif %}
            <div class="mb-0 profesor-info-item">
              <small class="text-muted d-block">Último acceso</small>
              <p class="mb-0">{{ user.last_login|date:"d/m/Y H:i"|default:"Primer acceso" }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% elif user.perfil.tipo_usuario == 'administrador' or user.perfil.tipo_usuario == 'director' %}
    <!-- ################################################## -->
    <!-- ######### PANEL ESPECÍFICO PARA ADMINISTRADORES Y DIRECTORES ######### -->
    <!-- ################################################## -->
    
    <!-- Estadísticas principales del sistema -->
    <div class="row mb-4 fade-in">
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-primary text-white h-100 admin-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-user-graduate fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ total_estudiantes_sistema|default:"0" }}</h3>
            <small>Estudiantes Totales</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-success text-white h-100 admin-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-chalkboard-teacher fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ total_profesores_sistema|default:"0" }}</h3>
            <small>Profesores Activos</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-warning text-white h-100 admin-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-school fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ total_cursos_activos|default:"0" }}</h3>
            <small>Cursos {{ anio_actual }}</small>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm bg-info text-white h-100 admin-stats-card">
          <div class="card-body text-center">
            <i class="fas fa-book fa-2x mb-2 opacity-75"></i>
            <h3 class="mb-1">{{ total_asignaturas_sistema|default:"0" }}</h3>
            <small>Asignaturas</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de accesos rápidos para administradores -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h4 class="mb-0 text-dark">
              <i class="fas fa-cogs text-primary me-2"></i>Panel de Administración
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_estudiantes' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-users fa-2x text-primary mb-2"></i>
                    <h6 class="mb-0">Gestionar Estudiantes</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_estudiantes' %}?tipo=profesor" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-chalkboard-teacher fa-2x text-success mb-2"></i>
                    <h6 class="mb-0">Gestionar Profesores</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_cursos' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-school fa-2x text-warning mb-2"></i>
                    <h6 class="mb-0">Gestionar Cursos</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'listar_asignaturas' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-book fa-2x text-info mb-2"></i>
                    <h6 class="mb-0">Gestionar Asignaturas</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'agregar' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-user-plus fa-2x text-danger mb-2"></i>
                    <h6 class="mb-0">Agregar Usuario</h6>
                  </div>
                </a>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'calendario' %}" class="quick-access-link text-decoration-none">
                  <div class="quick-access-card text-center p-3 rounded-3 h-100 border">
                    <i class="fas fa-calendar-check fa-2x text-secondary mb-2"></i>
                    <h6 class="mb-0">Calendario</h6>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel principal del sistema -->
    <div class="row">
      <!-- Información del sistema -->
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-chart-line text-primary me-2"></i>Estado del Sistema
            </h5>
          </div>
          <div class="card-body">
            {% if not error_admin %}
            
            <!-- Asistencia de hoy -->
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-calendar-day me-1"></i>Asistencia de Hoy
              </h6>
              {% if total_asistencias_hoy > 0 %}
              <div class="row g-2">
                <div class="col-md-4">
                  <div class="text-center p-3 bg-success text-white rounded">
                    <h5 class="mb-1">{{ presentes_hoy }}</h5>
                    <small>Presentes</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 bg-danger text-white rounded">
                    <h5 class="mb-1">{{ total_asistencias_hoy|add:"-"|add:presentes_hoy }}</h5>
                    <small>Ausentes</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 bg-info text-white rounded">
                    <h5 class="mb-1">{{ porcentaje_asistencia_hoy }}%</h5>
                    <small>Porcentaje</small>
                  </div>
                </div>
              </div>
              {% else %}
              <div class="alert alert-info text-center">
                <i class="fas fa-info-circle me-2"></i>No hay registros de asistencia para hoy
              </div>
              {% endif %}
            </div>

            <!-- Distribución por niveles -->
            {% if cursos_por_nivel %}
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-layer-group me-1"></i>Distribución por Niveles
              </h6>
              <div class="row g-2">
                {% for nivel, stats in cursos_por_nivel.items %}
                <div class="col-md-6 col-lg-4">
                  <div class="card border h-100">
                    <div class="card-body p-3 text-center">
                      <h6 class="mb-1">{{ nivel }}</h6>
                      <p class="mb-1 small text-muted">{{ stats.cursos }} curso{{ stats.cursos|pluralize:",s" }}</p>
                      <p class="mb-0 text-primary"><strong>{{ stats.estudiantes }} estudiantes</strong></p>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <!-- Estadísticas de anotaciones del sistema -->
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-sticky-note me-1"></i>Anotaciones del Sistema
              </h6>
              <div class="row g-2">
                <div class="col-md-3">
                  <div class="text-center p-2 bg-success text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones_sistema.positivas }}</h6>
                    <small>Positivas</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-warning text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones_sistema.neutras }}</h6>
                    <small>Neutras</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-danger text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones_sistema.negativas }}</h6>
                    <small>Negativas</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center p-2 bg-secondary text-white rounded">
                    <h6 class="mb-0">{{ stats_anotaciones_sistema.total }}</h6>
                    <small>Total</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Actividades recientes -->
            <div class="mb-4">
              <h6 class="text-muted mb-3">
                <i class="fas fa-clock me-1"></i>Actividad Reciente
              </h6>
              <div class="row g-2">
                {% if cursos_recientes %}
                <div class="col-md-4">
                  <div class="card border h-100">
                    <div class="card-header bg-light py-2">
                      <h6 class="mb-0 small">Cursos Recientes</h6>
                    </div>
                    <div class="card-body py-2">
                      {% for curso in cursos_recientes|slice:":3" %}
                      <div class="small mb-1">
                        <strong>{{ curso.get_nivel_display }}{{ curso.paralelo }}</strong>
                        <br><small class="text-muted">{{ curso.estudiantes.count }} estudiantes</small>
                      </div>
                      {% if not forloop.last %}<hr class="my-1">{% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
                
                {% if profesores_recientes %}
                <div class="col-md-4">
                  <div class="card border h-100">
                    <div class="card-header bg-light py-2">
                      <h6 class="mb-0 small">Profesores Recientes</h6>
                    </div>
                    <div class="card-body py-2">
                      {% for profesor in profesores_recientes|slice:":3" %}
                      <div class="small mb-1">
                        <strong>{{ profesor.get_nombre_completo|truncatechars:20 }}</strong>
                        <br><small class="text-muted">{{ profesor.asignaturas.count }} asignatura{{ profesor.asignaturas.count|pluralize:",s" }}</small>
                      </div>
                      {% if not forloop.last %}<hr class="my-1">{% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
                
                {% if estudiantes_recientes %}
                <div class="col-md-4">
                  <div class="card border h-100">
                    <div class="card-header bg-light py-2">
                      <h6 class="mb-0 small">Estudiantes Recientes</h6>
                    </div>
                    <div class="card-body py-2">
                      {% for estudiante in estudiantes_recientes|slice:":3" %}
                      <div class="small mb-1">
                        <strong>{{ estudiante.get_nombre_completo|truncatechars:18 }}</strong>
                        {% if estudiante.cursos.exists %}
                          <br><small class="text-muted">{{ estudiante.cursos.first.get_nivel_display }}{{ estudiante.cursos.first.paralelo }}</small>
                        {% endif %}
                      </div>
                      {% if not forloop.last %}<hr class="my-1">{% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>

            {% else %}
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>{{ error_admin }}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Panel lateral -->
      <div class="col-lg-4 mb-4">
        <!-- Próximos eventos -->
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-header bg-light border-0">
            <h6 class="mb-0">
              <i class="fas fa-calendar-alt text-warning me-2"></i>Próximos Eventos
            </h6>
          </div>
          <div class="card-body">
            {% if proximos_eventos %}
              {% for evento in proximos_eventos %}
              <div class="d-flex mb-2 p-2 rounded admin-item {% if not forloop.last %}border-bottom pb-3{% endif %}">
                <div class="me-2">
                  {% if evento.tipo_evento == 'evaluacion' %}
                    <i class="fas fa-clipboard-check text-warning"></i>
                  {% elif evento.tipo_evento == 'evento_especial' %}
                    <i class="fas fa-star text-success"></i>
                  {% else %}
                    <i class="fas fa-calendar text-info"></i>
                  {% endif %}
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1 small">{{ evento.titulo|truncatechars:25 }}</h6>
                  <p class="mb-0 small text-muted">{{ evento.descripcion|truncatechars:50 }}</p>
                  <small class="text-muted">{{ evento.fecha|date:"d/m/Y" }}</small>
                </div>
              </div>
              {% endfor %}
              <div class="text-center mt-2">
                <a href="{% url 'calendario' %}" class="btn btn-outline-warning btn-sm">
                  <i class="fas fa-eye me-1"></i>Ver Calendario
                </a>
              </div>
            {% else %}
              <div class="text-center text-muted">
                <i class="fas fa-calendar fa-2x mb-2"></i>
                <p class="mb-0 small">No hay eventos próximos</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Anotaciones recientes del sistema -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h6 class="mb-0">
              <i class="fas fa-comments text-info me-2"></i>Anotaciones Recientes
            </h6>
          </div>
          <div class="card-body">
            {% if anotaciones_recientes_sistema %}
              {% for anotacion in anotaciones_recientes_sistema|slice:":4" %}
              <div class="d-flex mb-2 p-2 rounded admin-item {% if not forloop.last %}border-bottom pb-3{% endif %}">
                <div class="me-2">
                  {% if anotacion.tipo == 'positiva' %}
                    <i class="fas fa-thumbs-up text-success"></i>
                  {% elif anotacion.tipo == 'negativa' %}
                    <i class="fas fa-thumbs-down text-danger"></i>
                  {% else %}
                    <i class="fas fa-minus text-warning"></i>
                  {% endif %}
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1 small">
                    {% if anotacion.estudiante %}
                      {{ anotacion.estudiante.get_nombre_completo|truncatechars:20 }}
                    {% else %}
                      {{ anotacion.curso.get_nivel_display }}{{ anotacion.curso.paralelo }} (General)
                    {% endif %}
                  </h6>
                  <p class="mb-0 small text-muted">{{ anotacion.contenido|truncatechars:45 }}</p>
                  <small class="text-muted">Por {{ anotacion.profesor_autor.get_nombre_completo|truncatechars:15 }}</small>
                </div>
              </div>
              {% endfor %}
              <div class="text-center mt-2">
                <a href="{% url 'libro_anotaciones' %}" class="btn btn-outline-info btn-sm">
                  <i class="fas fa-eye me-1"></i>Ver Todas
                </a>
              </div>
            {% else %}
              <div class="text-center text-muted">
                <i class="fas fa-clipboard fa-2x mb-2"></i>
                <p class="mb-0 small">No hay anotaciones recientes</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% else %}
    <!-- ################################################## -->
    <!-- ####### VISTA NORMAL PARA OTROS USUARIOS ######### -->
    <!-- ################################################## -->

    <!-- Panel de accesos rápidos para NO estudiantes -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border">
          <div class="card-header bg-light border-bottom">
            <h4 class="mb-0 text-dark">
              <i class="fas fa-rocket text-primary me-2"></i>Accesos Rápidos
            </h4>
          </div>
          <div class="card-body bg-white">
            <div class="row g-3">
              {% if user.perfil.tipo_usuario == 'administrador' %}
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'listar_estudiantes' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-users fa-2x text-primary mb-2"></i>
                      <h6 class="mb-0">Gestionar Estudiantes</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'listar_estudiantes' %}?tipo=profesor" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-chalkboard-teacher fa-2x text-success mb-2"></i>
                      <h6 class="mb-0">Gestionar Profesores</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'listar_cursos' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-school fa-2x text-warning mb-2"></i>
                      <h6 class="mb-0">Gestionar Cursos</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'listar_asignaturas' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-book fa-2x text-info mb-2"></i>
                      <h6 class="mb-0">Gestionar Asignaturas</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'agregar' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-user-plus fa-2x text-danger mb-2"></i>
                      <h6 class="mb-0">Agregar Usuario</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'calendario' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-calendar-check fa-2x text-secondary mb-2"></i>
                      <h6 class="mb-0">Calendario</h6>
                    </div>
                  </a>
                </div>
              {% elif user.perfil.tipo_usuario == 'profesor' %}
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'mis_horarios' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-clock fa-2x text-primary mb-2"></i>
                      <h6 class="mb-0">Mis Horarios</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'ingresar_notas' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-edit fa-2x text-success mb-2"></i>
                      <h6 class="mb-0">Ingresar Notas</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'registrar_asistencia_alumno' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-user-check fa-2x text-warning mb-2"></i>
                      <h6 class="mb-0">Registrar Asistencia</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'listar_asignaturas' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-book-open fa-2x text-info mb-2"></i>
                      <h6 class="mb-0">Mis Asignaturas</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'ver_notas_curso' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-chart-bar fa-2x text-danger mb-2"></i>
                      <h6 class="mb-0">Ver Calificaciones</h6>
                    </div>
                  </a>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                  <a href="{% url 'calendario' %}" class="quick-access-link text-decoration-none">
                    <div class="quick-access-card text-center p-3 rounded-3 h-100">
                      <i class="fas fa-calendar-alt fa-2x text-secondary mb-2"></i>
                      <h6 class="mb-0">Calendario</h6>
                    </div>
                  </a>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de información del sistema para NO estudiantes -->
    <div class="row">
      <!-- Panel principal específico por usuario -->
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0">
              <i class="fas fa-info-circle text-primary me-2"></i>Panel de Control
            </h5>
          </div>
          <div class="card-body">
            {% if user.perfil.tipo_usuario == 'profesor' %}
              <!-- PANEL ESPECÍFICO PARA PROFESORES -->
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-user me-1"></i>Profesor
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.get_full_name|default:user.username }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-envelope me-1"></i>Email
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.email|default:"No registrado" }}</p>
                  </div>
                </div>
                {% if profesor %}
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-chalkboard me-1"></i>Cursos como Jefe
                    </h6>
                    <p class="mb-0 fw-semibold">{{ cursos_jefe.count }} curso{{ cursos_jefe.count|pluralize:",s" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-book me-1"></i>Asignaturas
                    </h6>
                    <p class="mb-0 fw-semibold">{{ cursos_asignaturas.count }} asignatura{{ cursos_asignaturas.count|pluralize:",s" }}</p>
                  </div>
                </div>
                {% endif %}
              </div>
            {% else %}
              <!-- PANEL GENÉRICO PARA ADMINISTRADORES Y DIRECTORES -->
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-user me-1"></i>Usuario Activo
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.get_full_name|default:user.username }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-envelope me-1"></i>Email
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.email|default:"No registrado" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-calendar me-1"></i>Miembro desde
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.date_joined|date:"d/m/Y" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-item">
                    <h6 class="text-muted mb-1">
                      <i class="fas fa-clock me-1"></i>Último acceso
                    </h6>
                    <p class="mb-0 fw-semibold">{{ user.last_login|date:"d/m/Y H:i"|default:"Primer acceso" }}</p>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 mb-4">
        <!-- PANEL DE ANUNCIOS PARA NO ESTUDIANTES -->
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0">
              <i class="fas fa-bullhorn text-warning me-2"></i>Anuncios del Sistema
            </h5>
          </div>
          <div class="card-body">
            <div class="alert alert-info border-0 mb-3">
              <div class="d-flex">
                <i class="fas fa-info-circle me-2 mt-1"></i>
                <div>
                  <h6 class="alert-heading mb-1">Sistema Actualizado</h6>
                  <p class="mb-0 small">Nueva versión del sistema con mejoras de rendimiento.</p>
                </div>
              </div>
            </div>
            
            <div class="alert alert-success border-0 mb-0">
              <div class="d-flex">
                <i class="fas fa-check-circle me-2 mt-1"></i>
                <div>
                  <h6 class="alert-heading mb-1">Sistema Operativo</h6>
                  <p class="mb-0 small">Todos los servicios funcionando correctamente.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de permisos y funcionalidades para NO estudiantes -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0">
              <i class="fas fa-shield-alt text-primary me-2"></i>Permisos y Funcionalidades
            </h5>
          </div>
          <div class="card-body">
            {% if user.perfil.tipo_usuario == 'administrador' %}
              <div class="alert alert-danger border-0 mb-3">
                <div class="d-flex align-items-center">
                  <i class="fas fa-crown fa-2x text-danger me-3"></i>
                  <div>
                    <h6 class="alert-heading mb-1">Acceso de Administrador</h6>
                    <p class="mb-0">Tienes acceso completo a todas las funcionalidades del sistema.</p>
                  </div>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Gestión de Usuarios</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-user-plus text-primary me-1"></i> Crear estudiantes y profesores</li>
                    <li><i class="fas fa-user-edit text-warning me-1"></i> Modificar información de usuarios</li>
                    <li><i class="fas fa-user-times text-danger me-1"></i> Eliminar usuarios del sistema</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Gestión Académica</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-chalkboard text-info me-1"></i> Crear y gestionar cursos</li>
                    <li><i class="fas fa-book text-success me-1"></i> Administrar asignaturas</li>
                    <li><i class="fas fa-calendar-alt text-warning me-1"></i> Gestionar horarios y eventos</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Control de Notas</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-edit text-primary me-1"></i> Ingresar y modificar calificaciones</li>
                    <li><i class="fas fa-chart-bar text-info me-1"></i> Generar reportes académicos</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Control de Asistencia</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-clipboard-check text-success me-1"></i> Registrar asistencia de estudiantes</li>
                    <li><i class="fas fa-user-check text-warning me-1"></i> Controlar asistencia de profesores</li>
                  </ul>
                </div>
              </div>
            {% elif user.perfil.tipo_usuario == 'profesor' %}
              <div class="alert alert-warning border-0 mb-3">
                <div class="d-flex align-items-center">
                  <i class="fas fa-chalkboard-teacher fa-2x text-warning me-3"></i>
                  <div>
                    <h6 class="alert-heading mb-1">Acceso de Profesor</h6>
                    <p class="mb-0">Puedes gestionar las actividades académicas de tus cursos asignados.</p>
                  </div>
                </div>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Gestión de Clases</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-clock text-primary me-1"></i> Ver horarios de clases</li>
                    <li><i class="fas fa-book-open text-info me-1"></i> Gestionar asignaturas asignadas</li>
                    <li><i class="fas fa-calendar-plus text-success me-1"></i> Crear eventos académicos</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-success"><i class="fas fa-check me-1"></i> Evaluaciones</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-edit text-warning me-1"></i> Ingresar calificaciones</li>
                    <li><i class="fas fa-chart-line text-info me-1"></i> Ver reportes de notas</li>
                    <li><i class="fas fa-clipboard-check text-success me-1"></i> Tomar asistencia</li>
                  </ul>
                </div>
                <div class="col-md-12">
                  <h6 class="text-danger"><i class="fas fa-times me-1"></i> Restricciones</h6>
                  <ul class="list-unstyled ms-3">
                    <li><i class="fas fa-ban text-danger me-1"></i> No puede crear o eliminar usuarios</li>
                    <li><i class="fas fa-ban text-danger me-1"></i> No puede modificar cursos o asignaturas de otros profesores</li>
                  </ul>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  border: 1px solid #dee2e6;
}

.badge {
  font-size: 0.875rem;
}

.form-label {
  margin-bottom: 0.5rem;
}

.text-dark {
  color: #212529 !important;
}

.quick-access-card {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(0,0,0,0.125);
  border-radius: 15px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.1);
  overflow: hidden;
  position: relative;
  margin-bottom: 1.5rem;
}

.quick-access-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255,255,255,0.15), transparent);
  pointer-events: none;
  transition: opacity 0.3s ease;
  opacity: 0;
}

.quick-access-card:hover::before {
  opacity: 1;
}

.quick-access-card:hover {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 25px 50px rgba(0,0,0,0.25);
  border-color: rgba(255,255,255,0.4);
}

.quick-access-card i {
  transition: all 0.4s ease;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.quick-access-card:hover i {
  transform: scale(1.2) rotate(5deg);
  text-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.quick-access-card h6 {
  font-weight: 700;
  text-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.quick-access-card small {
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.stats-card {
  transition: all 0.4s ease;
  border-radius: 15px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,0,0,0.08);
  position: relative;
  overflow: hidden;
}

.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
  pointer-events: none;
}

.stats-card:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
  border-color: rgba(0,123,255,0.3);
}

.stats-card i {
  transition: transform 0.3s ease;
}

.stats-card:hover i {
  transform: scale(1.1);
}

.academic-section {
  margin-bottom: 3rem;
  padding: 1.5rem 0;
}

.section-title {
  border-bottom: 3px solid #e9ecef;
  padding-bottom: 0.75rem;
  margin-bottom: 2rem;
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -3px;
  left: 0;
  width: 60px;
  height: 3px;
  background: linear-gradient(90deg, #007bff, #0056b3);
  border-radius: 2px;
}

.horario-cell {
  min-width: 120px;
  padding: 8px 4px;
}

.clase-bloque {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border-radius: 6px;
  padding: 4px 6px;
  margin: 1px 0;
  font-size: 0.7rem;
  line-height: 1.2;
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.clase-bloque strong {
  display: block;
  font-weight: 600;
}

.clase-bloque small {
  opacity: 0.9;
  font-size: 0.65rem;
}

.tabla-horarios {
  font-size: 0.9rem;
}

.tabla-horarios th {
  background-color: #f8f9fa !important;
  font-weight: 600;
  border: 1px solid #dee2e6;
  vertical-align: middle;
}

.tabla-horarios td {
  border: 1px solid #dee2e6;
  vertical-align: middle;
}

.hora-columna {
  background-color: #f1f3f4;
  font-weight: 600;
  color: #495057;
}

@media (max-width: 768px) {
  .welcome-header .col-md-4 {
    margin-top: 1rem;
  }
  
  .tabla-horarios {
    font-size: 0.8rem;
  }
  
  .clase-bloque {
    font-size: 0.65rem;
    padding: 2px 4px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Actualizar fecha y hora actual
  function updateDateTime() {
    const now = new Date();
    const options = { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    document.getElementById('currentDateTime').textContent = now.toLocaleDateString('es-ES', options);
  }
  
  updateDateTime();
  setInterval(updateDateTime, 60000); // Actualizar cada minuto
  
  // Animación de entrada para las tarjetas de estadísticas
  const statsCards = document.querySelectorAll('.stats-card');
  statsCards.forEach((card, index) => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      card.style.transition = 'all 0.6s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, index * 150);
  });
  
  // Animación de entrada para accesos rápidos
  const quickAccessCards = document.querySelectorAll('.quick-access-card');
  quickAccessCards.forEach((card, index) => {
    card.style.opacity = '0';
    card.style.transform = 'scale(0.9)';
    
    setTimeout(() => {
      card.style.transition = 'all 0.4s ease';
      card.style.opacity = '1';
      card.style.transform = 'scale(1)';
    }, 600 + (index * 100));
  });
});
</script>
    {% endif %}
  </div>
</div>
{% endblock %}