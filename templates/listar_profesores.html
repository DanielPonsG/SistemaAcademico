{% extends "index_master.html" %}
{% load static %}

{% block extra_css %}
<style>
  /* Premium Design for Professors Page */
  .professors-page {
    padding: 2rem;
    background-color: #f8f9fa;
    min-height: 100vh;
    font-family: 'Inter', sans-serif;
  }

  /* Header Section */
  .professors-header {
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .professors-title h2 {
    font-size: 1.75rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .professors-title h2 i {
    color: #8b5cf6; /* Purple for professors */
  }

  .professors-subtitle {
    color: #64748b;
    margin: 0.5rem 0 0;
    font-size: 0.95rem;
  }

  .btn-new-professor {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
    text-decoration: none;
  }

  .btn-new-professor:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(124, 58, 237, 0.3);
    color: white;
  }

  /* Stats Cards */
  .professors-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .professors-stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: transform 0.3s ease;
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
  }

  .professors-stat-card:hover {
    transform: translateY(-5px);
  }

  .professors-stat-card::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 6px;
  }

  .professors-stat-card--primary::after { background: #8b5cf6; }
  .professors-stat-card--success::after { background: #10b981; }
  .professors-stat-card--info::after { background: #0ea5e9; }
  .professors-stat-card--warning::after { background: #f59e0b; }

  .professors-stat-card__icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .professors-stat-card--primary .professors-stat-card__icon { background: #f5f3ff; color: #8b5cf6; }
  .professors-stat-card--success .professors-stat-card__icon { background: #ecfdf5; color: #10b981; }
  .professors-stat-card--info .professors-stat-card__icon { background: #e0f2fe; color: #0ea5e9; }
  .professors-stat-card--warning .professors-stat-card__icon { background: #fffbeb; color: #f59e0b; }

  .professors-stat-card__metric {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    line-height: 1.2;
  }

  .professors-stat-card__label {
    color: #64748b;
    font-size: 0.875rem;
    margin: 0;
  }

  /* Search Section */
  .professors-search-section {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
  }

  .professors-search-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .professors-search-title i {
    color: #8b5cf6;
  }

  .professors-search-form {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .professors-search-input-wrapper {
    flex: 1;
    position: relative;
  }

  .professors-search-input-wrapper i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
  }

  .professors-search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #f8fafc;
  }

  .professors-search-input:focus {
    border-color: #8b5cf6;
    background: white;
    outline: none;
    box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
  }

  .btn-search {
    background: #8b5cf6;
    color: white;
    border: none;
    padding: 0 2rem;
    height: 54px;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
  }

  .btn-search:hover {
    background: #7c3aed;
    transform: translateY(-1px);
  }

  /* Table Section */
  .professors-table-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    overflow: hidden;
  }

  .professors-table-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .professors-table-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
  }

  .professors-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .professors-table th {
    background: #f8fafc;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    padding: 1rem 1.5rem;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
  }

  .professors-table td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
    color: #334155;
  }

  .professors-table tr:last-child td {
    border-bottom: none;
  }

  .professors-table tr:hover td {
    background: #f8fafc;
  }

  .professor-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .professor-avatar {
    width: 40px;
    height: 40px;
    background: #f5f3ff;
    color: #8b5cf6;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1.1rem;
  }

  .professor-details h4 {
    margin: 0;
    font-size: 0.95rem;
    font-weight: 600;
    color: #1e293b;
  }

  .professor-meta {
    display: flex;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.25rem;
  }

  .professor-meta span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .status-badge {
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }

  .status-badge--active {
    background: #ecfdf5;
    color: #10b981;
  }

  .status-badge--inactive {
    background: #fef2f2;
    color: #ef4444;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
  }

  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    margin-right: 0.25rem;
  }

  .action-btn--edit {
    background: #f5f3ff;
    color: #8b5cf6;
  }

  .action-btn--edit:hover {
    background: #8b5cf6;
    color: white;
  }

  .action-btn--delete {
    background: #fef2f2;
    color: #ef4444;
  }

  .action-btn--delete:hover {
    background: #ef4444;
    color: white;
  }

  .action-btn--key {
    background: #fffbeb;
    color: #f59e0b;
  }

  .action-btn--key:hover {
    background: #f59e0b;
    color: white;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #64748b;
  }

  .empty-state i {
    font-size: 3rem;
    color: #cbd5e1;
    margin-bottom: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="right_col" role="main">
  <div class="container-fluid professors-page">
    
    <!-- Header -->
    <header class="professors-header">
      <div class="professors-title">
        <h2><i class="fas fa-chalkboard-teacher"></i> Gestión de Profesores</h2>
        <p class="professors-subtitle">Administra el cuerpo docente, asignaciones y accesos al sistema.</p>
      </div>
      <a href="{% url 'gestionar_profesor' %}" class="btn-new-professor">
        <i class="fas fa-plus"></i> Nuevo profesor
      </a>
    </header>

    <!-- Stats -->
    <section class="professors-stats">
      <article class="professors-stat-card professors-stat-card--primary">
        <span class="professors-stat-card__icon"><i class="fas fa-users"></i></span>
        <div>
          <p class="professors-stat-card__metric">{{ total_profesores|default:"0" }}</p>
          <p class="professors-stat-card__label">Profesores registrados</p>
        </div>
      </article>
      
      <article class="professors-stat-card professors-stat-card--success">
        <span class="professors-stat-card__icon"><i class="fas fa-user-check"></i></span>
        <div>
          <p class="professors-stat-card__metric">{{ profesores_activos|default:"0" }}</p>
          <p class="professors-stat-card__label">Profesores activos</p>
        </div>
      </article>
      
      <article class="professors-stat-card professors-stat-card--info">
        <span class="professors-stat-card__icon"><i class="fas fa-book"></i></span>
        <div>
          <p class="professors-stat-card__metric">{{ profesores_con_asignaturas|default:"0" }}</p>
          <p class="professors-stat-card__label">Con carga académica</p>
        </div>
      </article>
      
      <article class="professors-stat-card professors-stat-card--warning">
        <span class="professors-stat-card__icon"><i class="fas fa-layer-group"></i></span>
        <div>
          <p class="professors-stat-card__metric">{{ asignaturas_count|default:"0" }}</p>
          <p class="professors-stat-card__label">Total asignaturas</p>
        </div>
      </article>
    </section>

    <!-- Search -->
    <section class="professors-search-section">
      <h3 class="professors-search-title">
        <i class="fas fa-search"></i> Filtra el listado docente
      </h3>
      <form method="get" class="professors-search-form">
        <div class="professors-search-input-wrapper">
          <i class="fas fa-search"></i>
          <input 
            type="text" 
            name="q_profesor" 
            class="professors-search-input" 
            placeholder="Buscar por nombre, apellido o código..." 
            value="{{ q_profesor }}"
          >
        </div>
        <button type="submit" class="btn-search">
          <i class="fas fa-filter"></i> Buscar
        </button>
      </form>
    </section>

    <!-- Table -->
    <section class="professors-table-container">
      <div class="professors-table-header">
        <h3><i class="fas fa-list"></i> Listado de profesores</h3>
      </div>

      {% if profesores %}
        <div class="table-responsive">
          <table class="professors-table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Profesor</th>
                <th>Contacto</th>
                <th>Especialidad</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for profesor in profesores %}
                <tr>
                  <td>
                    <span style="font-family: monospace; color: #8b5cf6; font-weight: 600;">
                      #{{ profesor.codigo_profesor|default:"--" }}
                    </span>
                  </td>
                  <td>
                    <div class="professor-info">
                      <div class="professor-avatar">
                        {{ profesor.primer_nombre|first }}{{ profesor.apellido_paterno|first }}
                      </div>
                      <div class="professor-details">
                        <h4>{{ profesor.primer_nombre }} {{ profesor.apellido_paterno }}</h4>
                        <div class="professor-meta">
                          <span><i class="fas fa-id-card"></i> {{ profesor.rut }}</span>
                          {% if profesor.user %}
                            <span><i class="fas fa-user"></i> {{ profesor.user.username }}</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="professor-details">
                      <div class="professor-meta" style="flex-direction: column; gap: 0.25rem;">
                        {% if profesor.email %}
                          <span><i class="fas fa-envelope"></i> {{ profesor.email }}</span>
                        {% endif %}
                        {% if profesor.telefono %}
                          <span><i class="fas fa-phone"></i> {{ profesor.telefono }}</span>
                        {% endif %}
                      </div>
                    </div>
                  </td>
                  <td>
                    {% if profesor.especialidad %}
                      <span class="status-badge status-badge--active" style="background: #f5f3ff; color: #7c3aed;">
                        <i class="fas fa-star"></i> {{ profesor.especialidad }}
                      </span>
                    {% else %}
                      <span class="status-badge status-badge--inactive" style="background: #f1f5f9; color: #64748b;">
                        Sin especialidad
                      </span>
                    {% endif %}
                  </td>
                  <td>
                    {% if profesor.user and profesor.user.is_active %}
                      <span class="status-badge status-badge--active">
                        <span class="status-dot"></span> Activo
                      </span>
                    {% else %}
                      <span class="status-badge status-badge--inactive">
                        <span class="status-dot"></span> Inactivo
                      </span>
                    {% endif %}
                  </td>
                  <td>
                    <div style="display: flex;">
                      <a href="{% url 'gestionar_profesor' profesor.id %}" class="action-btn action-btn--edit" title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <form method="post" action="{% url 'eliminar' %}?tipo=profesor" style="display: inline;" onsubmit="return confirm('¿Está seguro de eliminar este profesor?');">
                        {% csrf_token %}
                        <input type="hidden" name="eliminar_por_id" value="true">
                        <input type="hidden" name="id_a_eliminar" value="{{ profesor.id }}">
                        <button type="submit" class="action-btn action-btn--delete" title="Eliminar">
                          <i class="fas fa-trash"></i>
                        </button>
                      </form>
                      {% if profesor.user %}
                        <button type="button" class="action-btn action-btn--key" title="Resetear contraseña" onclick="resetPassword('{{ profesor.id }}')">
                          <i class="fas fa-key"></i>
                        </button>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="empty-state">
          <i class="fas fa-chalkboard-teacher"></i>
          <h4>No se encontraron profesores</h4>
          <p>Intenta ajustar los filtros de búsqueda o agrega un nuevo profesor.</p>
        </div>
      {% endif %}
    </section>
  </div>
</div>

<script>
function resetPassword(profesorId) {
    if(confirm('¿Está seguro de resetear la contraseña de este profesor?')) {
        fetch(`/reset-password-profesor/${profesorId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                alert('Contraseña reseteada exitosamente. Nueva contraseña: ' + data.new_password);
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Ocurrió un error al procesar la solicitud.');
        });
    }
}
</script>
{% endblock %}
