{% extends "index_master.html" %}
{% load static %}

{% block extra_css %}
<style>
  /* Premium Design for Students Page */
  .students-page {
    padding: 2rem;
    background-color: #f8f9fa;
    min-height: 100vh;
    font-family: 'Inter', sans-serif;
  }

  /* Header Section */
  .students-header {
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .students-title h2 {
    font-size: 1.75rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .students-title h2 i {
    color: #3b82f6;
  }

  .students-subtitle {
    color: #64748b;
    margin: 0.5rem 0 0;
    font-size: 0.95rem;
  }

  .btn-new-student {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    text-decoration: none;
  }

  .btn-new-student:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
    color: white;
  }

  /* Stats Cards */
  .students-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .students-stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: transform 0.3s ease;
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
  }

  .students-stat-card:hover {
    transform: translateY(-5px);
  }

  .students-stat-card::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 6px;
  }

  .students-stat-card--primary::after { background: #3b82f6; }
  .students-stat-card--success::after { background: #10b981; }
  .students-stat-card--info::after { background: #0ea5e9; }
  .students-stat-card--warning::after { background: #f59e0b; }

  .students-stat-card__icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .students-stat-card--primary .students-stat-card__icon { background: #eff6ff; color: #3b82f6; }
  .students-stat-card--success .students-stat-card__icon { background: #ecfdf5; color: #10b981; }
  .students-stat-card--info .students-stat-card__icon { background: #e0f2fe; color: #0ea5e9; }
  .students-stat-card--warning .students-stat-card__icon { background: #fffbeb; color: #f59e0b; }

  .students-stat-card__metric {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    line-height: 1.2;
  }

  .students-stat-card__label {
    color: #64748b;
    font-size: 0.875rem;
    margin: 0;
  }

  /* Search Section */
  .students-search-section {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
  }

  .students-search-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .students-search-title i {
    color: #3b82f6;
  }

  .students-search-form {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .students-search-input-wrapper {
    flex: 1;
    position: relative;
  }

  .students-search-input-wrapper i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
  }

  .students-search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #f8fafc;
  }

  .students-search-input:focus {
    border-color: #3b82f6;
    background: white;
    outline: none;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  .btn-search {
    background: #3b82f6;
    color: white;
    border: none;
    padding: 0 2rem;
    height: 54px;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
  }

  .btn-search:hover {
    background: #2563eb;
    transform: translateY(-1px);
  }

  /* Table Section */
  .students-table-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    overflow: hidden;
  }

  .students-table-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
  }

  .students-table-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
  }

  .students-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .students-table th {
    background: #f8fafc;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    padding: 1rem 1.5rem;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
  }

  .students-table td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
    color: #334155;
  }

  .students-table tr:last-child td {
    border-bottom: none;
  }

  .students-table tr:hover td {
    background: #f8fafc;
  }

  .student-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .student-avatar {
    width: 40px;
    height: 40px;
    background: #eff6ff;
    color: #3b82f6;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1.1rem;
  }

  .student-details h4 {
    margin: 0;
    font-size: 0.95rem;
    font-weight: 600;
    color: #1e293b;
  }

  .student-meta {
    display: flex;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.25rem;
  }

  .student-meta span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .status-badge {
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }

  .status-badge--active {
    background: #ecfdf5;
    color: #10b981;
  }

  .status-badge--inactive {
    background: #fef2f2;
    color: #ef4444;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
  }

  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    margin-right: 0.25rem;
  }

  .action-btn--edit {
    background: #eff6ff;
    color: #3b82f6;
  }

  .action-btn--edit:hover {
    background: #3b82f6;
    color: white;
  }

  .action-btn--delete {
    background: #fef2f2;
    color: #ef4444;
  }

  .action-btn--delete:hover {
    background: #ef4444;
    color: white;
  }

  .action-btn--key {
    background: #fffbeb;
    color: #f59e0b;
  }

  .action-btn--key:hover {
    background: #f59e0b;
    color: white;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #64748b;
  }

  .empty-state i {
    font-size: 3rem;
    color: #cbd5e1;
    margin-bottom: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="right_col" role="main">
  <div class="container-fluid students-page">
    
    <!-- Header -->
    <header class="students-header">
      <div class="students-title">
        <h2><i class="fas fa-user-graduate"></i> Gestión de Estudiantes</h2>
        <p class="students-subtitle">Administra la nómina estudiantil, cursos y accesos al sistema académico.</p>
      </div>
      <a href="{% url 'agregar' %}?tipo=estudiante" class="btn-new-student">
        <i class="fas fa-plus"></i> Nuevo estudiante
      </a>
    </header>

    <!-- Stats -->
    <section class="students-stats">
      <article class="students-stat-card students-stat-card--primary">
        <span class="students-stat-card__icon"><i class="fas fa-users"></i></span>
        <div>
          <p class="students-stat-card__metric">{{ total_estudiantes|default:"0" }}</p>
          <p class="students-stat-card__label">Estudiantes registrados</p>
        </div>
      </article>
      
      <article class="students-stat-card students-stat-card--success">
        <span class="students-stat-card__icon"><i class="fas fa-user-check"></i></span>
        <div>
          <p class="students-stat-card__metric">{{ estudiantes_activos|default:"0" }}</p>
          <p class="students-stat-card__label">Estudiantes activos</p>
        </div>
      </article>
      
      <article class="students-stat-card students-stat-card--info">
        <span class="students-stat-card__icon"><i class="fas fa-chalkboard"></i></span>
        <div>
          <p class="students-stat-card__metric">{{ cursos_count|default:"0" }}</p>
          <p class="students-stat-card__label">Cursos activos</p>
        </div>
      </article>
      
      <article class="students-stat-card students-stat-card--warning">
        <span class="students-stat-card__icon"><i class="fas fa-user-clock"></i></span>
        <div>
          <p class="students-stat-card__metric">{{ estudiantes_sin_curso|default:"0" }}</p>
          <p class="students-stat-card__label">Sin curso asignado</p>
        </div>
      </article>
    </section>

    <!-- Search -->
    <section class="students-search-section">
      <h3 class="students-search-title">
        <i class="fas fa-search"></i> Filtra el listado estudiantil
      </h3>
      <form method="get" class="students-search-form">
        <div class="students-search-input-wrapper">
          <i class="fas fa-search"></i>
          <input 
            type="text" 
            name="q_estudiante" 
            class="students-search-input" 
            placeholder="Buscar por nombre, apellido, RUT o código..." 
            value="{{ q_estudiante }}"
          >
        </div>
        <button type="submit" class="btn-search">
          <i class="fas fa-filter"></i> Buscar
        </button>
      </form>
    </section>

    <!-- Table -->
    <section class="students-table-container">
      <div class="students-table-header">
        <h3><i class="fas fa-list"></i> Listado de estudiantes</h3>
      </div>

      {% if estudiantes %}
        <div class="table-responsive">
          <table class="students-table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Estudiante</th>
                <th>Contacto</th>
                <th>Curso</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for estudiante in estudiantes %}
                <tr>
                  <td>
                    <span style="font-family: monospace; color: #3b82f6; font-weight: 600;">
                      #{{ estudiante.codigo_estudiante|default:"--" }}
                    </span>
                  </td>
                  <td>
                    <div class="student-info">
                      <div class="student-avatar">
                        {{ estudiante.primer_nombre|first }}{{ estudiante.apellido_paterno|first }}
                      </div>
                      <div class="student-details">
                        <h4>{{ estudiante.primer_nombre }} {{ estudiante.apellido_paterno }}</h4>
                        <div class="student-meta">
                          <span><i class="fas fa-id-card"></i> {{ estudiante.numero_documento }}</span>
                          {% if estudiante.user %}
                            <span><i class="fas fa-user"></i> {{ estudiante.user.username }}</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="student-details">
                      <div class="student-meta" style="flex-direction: column; gap: 0.25rem;">
                        {% if estudiante.email %}
                          <span><i class="fas fa-envelope"></i> {{ estudiante.email }}</span>
                        {% endif %}
                        {% if estudiante.telefono %}
                          <span><i class="fas fa-phone"></i> {{ estudiante.telefono }}</span>
                        {% endif %}
                      </div>
                    </div>
                  </td>
                  <td>
                    {% with curso=estudiante.get_curso_actual %}
                      {% if curso %}
                        <span class="status-badge status-badge--active" style="background: #e0f2fe; color: #0284c7;">
                          <i class="fas fa-graduation-cap"></i> {{ curso.nombre }}
                        </span>
                      {% else %}
                        <span class="status-badge status-badge--inactive" style="background: #f1f5f9; color: #64748b;">
                          Sin curso
                        </span>
                      {% endif %}
                    {% endwith %}
                  </td>
                  <td>
                    {% if estudiante.user and estudiante.user.is_active %}
                      <span class="status-badge status-badge--active">
                        <span class="status-dot"></span> Activo
                      </span>
                    {% else %}
                      <span class="status-badge status-badge--inactive">
                        <span class="status-dot"></span> Inactivo
                      </span>
                    {% endif %}
                  </td>
                  <td>
                    <div style="display: flex;">
                      <a href="{% url 'modificar' %}?tipo=estudiante&id={{ estudiante.id }}" class="action-btn action-btn--edit" title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <form method="post" action="{% url 'eliminar' %}?tipo=estudiante" style="display: inline;" onsubmit="return confirm('¿Está seguro de eliminar este estudiante?');">
                        {% csrf_token %}
                        <input type="hidden" name="eliminar_por_id" value="true">
                        <input type="hidden" name="id_a_eliminar" value="{{ estudiante.id }}">
                        <button type="submit" class="action-btn action-btn--delete" title="Eliminar">
                          <i class="fas fa-trash"></i>
                        </button>
                      </form>
                      {% if estudiante.user %}
                        <button type="button" class="action-btn action-btn--key" title="Resetear contraseña" onclick="alert('Funcionalidad pendiente de implementación')">
                          <i class="fas fa-key"></i>
                        </button>
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="empty-state">
          <i class="fas fa-user-graduate"></i>
          <h4>No se encontraron estudiantes</h4>
          <p>Intenta ajustar los filtros de búsqueda o agrega un nuevo estudiante.</p>
        </div>
      {% endif %}
    </section>
  </div>
</div>
{% endblock %}
