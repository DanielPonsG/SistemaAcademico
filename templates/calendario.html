{% extends "index_master.html" %}

{% block content %}
<div class="right_col" role="main">
  <div class="container-fluid">
    
    {% if user.perfil.tipo_usuario == 'alumno' %}
    <!-- ################################################## -->
    <!-- ############ VISTA OPTIMIZADA PARA ALUMNOS ############## -->
    <!-- ################################################## -->
    
    <!-- Header personalizado para alumnos -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="bg-white p-4 rounded shadow-sm border">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <i class="fas fa-calendar-alt fa-3x text-primary"></i>
                </div>
                <div>
                  <h1 class="h3 mb-1 text-dark">Mi Calendario Académico</h1>
                  <p class="mb-0 text-muted">
                    <i class="fas fa-user me-2"></i>
                    Eventos y actividades para {{ user.first_name|default:user.username }}
                  </p>
                </div>
              </div>
            </div>
            <div class="col-md-4 text-end d-none d-md-block">
              <div class="text-center">
                <p class="mb-0 h5 text-primary" id="currentDateTime"></p>
                <small class="text-muted">Fecha actual</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estadísticas académicas para alumnos -->
    <div class="row mb-4">
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-check fa-3x text-success"></i>
            </div>
            <h4 class="text-success mb-1">{{ eventos.count }}</h4>
            <p class="mb-0 small text-muted">Eventos disponibles</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-day fa-3x text-info"></i>
            </div>
            <h4 class="text-info mb-1">{{ eventos_count.hoy|default:0 }}</h4>
            <p class="mb-0 small text-muted">Eventos hoy</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-week fa-3x text-warning"></i>
            </div>
            <h4 class="text-warning mb-1">{{ eventos_count.semana|default:0 }}</h4>
            <p class="mb-0 small text-muted">Esta semana</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-school fa-3x text-purple"></i>
            </div>
            <h6 class="text-purple mb-1">{{ user.estudiante.get_curso_actual|default:"Sin curso" }}</h6>
            <p class="mb-0 small text-muted">Mi curso</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendario y eventos para alumnos -->
    <div class="row">
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-calendar text-primary me-2"></i>
              Calendario Académico
            </h5>
          </div>
          <div class="card-body">
            <div id="calendar" style="height: 600px;"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 mb-4">
        <!-- Próximos eventos para el alumno -->
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-bell text-warning me-2"></i>
              Mis Próximos Eventos
              <span class="badge bg-warning ms-2">{{ eventos.count }}</span>
            </h5>
          </div>
          <div class="card-body">
            {% if eventos %}
              <div class="student-events-list">
                {% for evento in eventos|slice:":5" %}
                <div class="event-card student-event-item mb-3 p-3 border rounded">
                  <div class="d-flex align-items-start">
                    <div class="event-icon-student me-3">
                      <div class="rounded-circle d-flex align-items-center justify-content-center" 
                           style="width: 50px; height: 50px; background: linear-gradient(135deg, {{ evento.color_por_tipo }}, {{ evento.color_por_tipo }}aa); color: white;">
                        <strong>{{ evento.fecha.day }}</strong>
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-1 fw-bold">{{ evento.titulo }}</h6>
                      <div class="event-meta">
                        <p class="mb-1 small text-muted">
                          <i class="fas fa-calendar-alt me-1"></i>
                          {{ evento.fecha|date:"l, j F Y" }}
                        </p>
                        {% if evento.hora_inicio %}
                          <p class="mb-1 small text-muted">
                            <i class="fas fa-clock me-1"></i>
                            {{ evento.hora_inicio|time:"H:i" }}
                            {% if evento.hora_fin %} - {{ evento.hora_fin|time:"H:i" }}{% endif %}
                          </p>
                        {% endif %}
                        <p class="mb-1 small">
                          <span class="badge badge-event-type" style="background-color: {{ evento.color_por_tipo }};">
                            {{ evento.get_tipo_evento_display }}
                          </span>
                        </p>
                      </div>
                      {% if evento.descripcion %}
                        <p class="mb-0 small text-secondary">{{ evento.descripcion|truncatewords:12 }}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
                {% endfor %}
                
                {% if eventos.count > 5 %}
                <div class="text-center mt-3">
                  <small class="text-muted">Y {{ eventos.count|add:"-5" }} eventos más...</small>
                </div>
                {% endif %}
              </div>
            {% else %}
              <div class="text-center py-5">
                <i class="fas fa-calendar-plus fa-4x text-muted mb-3"></i>
                <h6 class="text-muted">No hay eventos programados</h6>
                <p class="small text-muted">Los eventos de tu curso aparecerán aquí cuando estén disponibles.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% else %}
    <!-- ################################################## -->
    <!-- ##### VISTA OPTIMIZADA PARA ADMINISTRADORES Y DIRECTORES ##### -->
    <!-- ################################################## -->
    
    <!-- Header personalizado para administradores -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="bg-white p-4 rounded shadow-sm border">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <i class="fas fa-calendar-alt fa-3x text-primary"></i>
                </div>
                <div>
                  <h1 class="h3 mb-1 text-dark">Gestión de Calendario</h1>
                  <p class="mb-0 text-muted">
                    <i class="fas fa-user-shield me-2"></i>
                    Panel administrativo para {{ user.first_name|default:user.username }}
                  </p>
                </div>
              </div>
            </div>
            <div class="col-md-4 text-end">
              {% if puede_crear_eventos %}
              <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modalAgregarEvento">
                <i class="fas fa-plus me-2"></i>Nuevo Evento
              </button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estadísticas del calendario para administradores -->
    <div class="row mb-4">
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card admin-stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-check fa-3x text-primary"></i>
            </div>
            <h3 class="text-primary mb-1">{{ eventos.count }}</h3>
            <p class="mb-0 small text-muted">Eventos Totales</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card admin-stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-day fa-3x text-success"></i>
            </div>
            <h3 class="text-success mb-1">{{ eventos_count.hoy|default:0 }}</h3>
            <p class="mb-0 small text-muted">Eventos Hoy</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card admin-stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-calendar-week fa-3x text-warning"></i>
            </div>
            <h3 class="text-warning mb-1">{{ eventos_count.semana|default:0 }}</h3>
            <p class="mb-0 small text-muted">Esta Semana</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card admin-stats-card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="mb-3">
              <i class="fas fa-user-shield fa-3x text-info"></i>
            </div>
            <h6 class="text-info mb-1">{{ user.perfil.tipo_usuario|capfirst }}</h6>
            <p class="mb-0 small text-muted">Rol Actual</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendario y eventos para administradores -->
    <div class="row">
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-calendar text-primary me-2"></i>
              Calendario Administrativo
            </h5>
          </div>
          <div class="card-body">
            <div id="calendar" style="height: 600px;"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 mb-4">
        <!-- Gestión de eventos para administradores -->
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-light border-0">
            <h5 class="mb-0 text-dark">
              <i class="fas fa-cogs text-warning me-2"></i>
              Gestión de Eventos
              <span class="badge bg-primary ms-2">{{ eventos.count }}</span>
            </h5>
          </div>
          <div class="card-body">
            {% if eventos %}
              <div class="admin-events-list" style="max-height: 500px; overflow-y: auto;">
                {% for evento in eventos %}
                <div class="event-card admin-item mb-3 p-3 border rounded">
                  <div class="d-flex align-items-start">
                    <div class="event-icon-admin me-3">
                      <div class="text-center" style="background-color: {{ evento.color_por_tipo|default:'#007bff' }}; color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        {{ evento.fecha.day }}
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-1 text-dark">{{ evento.titulo|truncatechars:25 }}</h6>
                      <div class="event-meta">
                        <p class="mb-1 small text-muted">
                          <i class="fas fa-calendar me-1"></i>{{ evento.fecha|date:"d/m/Y" }}
                          {% if evento.hora_inicio %}
                            | <i class="fas fa-clock me-1"></i>{{ evento.hora_inicio|time:"H:i" }}
                            {% if evento.hora_fin %} - {{ evento.hora_fin|time:"H:i" }}{% endif %}
                          {% endif %}
                        </p>
                        <p class="mb-1 small text-muted">
                          <i class="fas fa-user me-1"></i>
                          {% if evento.creado_por %}
                            {{ evento.creado_por.first_name|default:evento.creado_por.username }}
                          {% else %}
                            Sistema
                          {% endif %}
                        </p>
                        {% if evento.tipo_evento %}
                        <span class="badge badge-event-type" style="background-color: {{ evento.color_por_tipo|default:'#6c757d' }};">
                          {{ evento.get_tipo_evento_display|default:evento.tipo_evento }}
                        </span>
                        {% endif %}
                      </div>
                      {% if evento.descripcion %}
                        <p class="mb-2 small">{{ evento.descripcion|truncatewords:10 }}</p>
                      {% endif %}
                      {% if puede_crear_eventos %}
                      <div class="btn-group btn-group-sm mt-2">
                        <a href="{% url 'editar_evento' evento.id %}" class="btn btn-outline-info btn-sm">
                          <i class="fas fa-edit"></i> Editar
                        </a>
                        <button onclick="eliminarEvento({{ evento.id }}, '{{ evento.titulo }}')" class="btn btn-outline-danger btn-sm">
                          <i class="fas fa-trash"></i> Eliminar
                        </button>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="text-center py-5">
                <i class="fas fa-calendar-plus fa-4x text-muted mb-3"></i>
                <h6 class="text-muted">No hay eventos programados</h6>
                <p class="small text-muted">Crea el primer evento del sistema.</p>
                {% if puede_crear_eventos %}
                  <button type="button" class="btn btn-primary btn-sm mt-2" data-toggle="modal" data-target="#modalAgregarEvento">
                    <i class="fas fa-plus me-1"></i>Crear Primer Evento
                  </button>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    {% endif %}
  </div>
</div>

{% if puede_crear_eventos %}
<!-- Modal para agregar evento -->
<div class="modal fade" id="modalAgregarEvento" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">
          <i class="fa fa-calendar-plus-o"></i> Agregar Nuevo Evento
        </h4>
      </div>
      <form id="formAgregarEvento" method="post">
        {% csrf_token %}
        <div class="modal-body">
          <div class="row">
            <div class="col-md-8">
              <div class="form-group">
                <label>Título del evento *</label>
                <input type="text" name="titulo" class="form-control" placeholder="Ej: Reunión de profesores" required>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>Fecha *</label>
                <input type="date" name="fecha" class="form-control" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Hora inicio</label>
                <input type="time" name="hora_inicio" class="form-control">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Hora fin</label>
                <input type="time" name="hora_fin" class="form-control">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Tipo de evento</label>
                <select name="tipo_evento" class="form-control">
                  <option value="general">General</option>
                  <option value="evaluacion">Evaluación</option>
                  <option value="reunion">Reunión</option>
                  <option value="actividad">Actividad</option>
                  <option value="administrativo">Administrativo</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Prioridad</label>
                <select name="prioridad" class="form-control">
                  <option value="baja">Baja</option>
                  <option value="media" selected>Media</option>
                  <option value="alta">Alta</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Descripción</label>
            <textarea name="descripcion" class="form-control" rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label>Dirigido a</label>
            <div class="radio">
              <label>
                <input type="radio" name="dirigido_a" value="todos" checked> Todos los cursos
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name="dirigido_a" value="solo_profesores"> Solo profesores
              </label>
            </div>
            {% if cursos %}
            <div class="radio">
              <label>
                <input type="radio" name="dirigido_a" value="cursos_especificos"> Cursos específicos
              </label>
            </div>
            <div id="cursosEspecificos" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
              <div class="row">
                {% for curso in cursos %}
                <div class="col-md-6">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" name="cursos_especificos" value="{{ curso.id }}">
                      {{ curso.paralelo }} - {{ curso.get_nivel_display }}
                    </label>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}
          </div>
          
          <div class="alert alert-info">
            <i class="fa fa-info-circle"></i>
            <strong>Responsable:</strong> {{ request.user.first_name|default:request.user.username }}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-save"></i> Crear Evento
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<!-- FullCalendar CSS y JS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/es.min.js"></script>

<!-- Estilos específicos para la vista de alumnos -->
<style>
/* Estilos para la vista de alumnos */
.text-purple {
  color: #6f42c1 !important;
}

.stats-card {
  transition: all 0.4s ease;
  border-radius: 15px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,0,0,0.08);
  position: relative;
  overflow: hidden;
}

.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
  pointer-events: none;
}

.stats-card:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
  border-color: rgba(0,123,255,0.3);
}

.stats-card i {
  transition: transform 0.3s ease;
}

.stats-card:hover i {
  transform: scale(1.15) rotate(5deg);
}

.student-events-list {
  max-height: 500px;
  overflow-y: auto;
}

.student-event-item {
  transition: all 0.3s ease;
  border: 1px solid #e9ecef !important;
  border-radius: 12px !important;
  background: linear-gradient(135deg, #ffffff, #f8f9fa);
  position: relative;
  overflow: hidden;
}

.student-event-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.student-event-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  border-color: rgba(0,123,255,0.3) !important;
}

.student-event-item:hover::before {
  opacity: 1;
}

.event-icon-student {
  transition: transform 0.3s ease;
}

.student-event-item:hover .event-icon-student {
  transform: scale(1.1);
}

.badge-event-type {
  font-size: 0.7rem;
  padding: 0.35em 0.65em;
  border-radius: 10rem;
  color: white !important;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.event-meta p {
  margin-bottom: 0.25rem !important;
}

.event-meta i {
  width: 12px;
  text-align: center;
}

/* Mejoras al calendario para alumnos */
#calendar {
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.fc-event {
  border: none !important;
  border-radius: 8px !important;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
}

.fc-event:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(0,0,0,0.25);
}

.fc-header-toolbar {
  padding: 1rem !important;
  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  border-radius: 15px 15px 0 0;
}

.fc-button {
  border-radius: 8px !important;
  font-weight: 600;
  transition: all 0.3s ease;
}

.fc-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Animaciones de entrada */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.stats-card,
.student-event-item {
  animation: slideInUp 0.6s ease forwards;
}

.stats-card:nth-child(1) { animation-delay: 0.1s; }
.stats-card:nth-child(2) { animation-delay: 0.2s; }
.stats-card:nth-child(3) { animation-delay: 0.3s; }
.stats-card:nth-child(4) { animation-delay: 0.4s; }

/* Responsive para móviles */
@media (max-width: 768px) {
  .student-events-list {
    max-height: 400px;
  }
  
  .student-event-item {
    margin-bottom: 1rem !important;
  }
  
  .event-icon-student div {
    width: 40px !important;
    height: 40px !important;
    font-size: 0.9rem;
  }
  
  .stats-card .card-body {
    padding: 1rem;
  }
  
  .stats-card i {
    font-size: 2rem !important;
  }
}

/* Scroll personalizado para la lista de eventos */
.student-events-list::-webkit-scrollbar {
  width: 6px;
}

.student-events-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.student-events-list::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #007bff, #0056b3);
  border-radius: 10px;
}

.student-events-list::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #0056b3, #004085);
}

/* Estilos específicos para administradores y directores */
.admin-stats-card {
  transition: all 0.4s ease;
  border-radius: 15px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,0,0,0.08);
  position: relative;
  overflow: hidden;
}

.admin-stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
  pointer-events: none;
}

.admin-stats-card:hover {
  transform: translateY(-8px) scale(1.03);
  box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  border-color: rgba(0,123,255,0.4);
}

.admin-stats-card i {
  transition: transform 0.3s ease;
}

.admin-stats-card:hover i {
  transform: scale(1.2) rotate(10deg);
}

.admin-events-list {
  max-height: 500px;
  overflow-y: auto;
}

.admin-events-list::-webkit-scrollbar {
  width: 8px;
}

.admin-events-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.admin-events-list::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #28a745, #20c997);
  border-radius: 10px;
}

.admin-events-list::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #20c997, #17a2b8);
}

.admin-item {
  transition: all 0.3s ease;
  border-radius: 12px !important;
  background: linear-gradient(135deg, #ffffff, #f8f9fa);
  position: relative;
  overflow: hidden;
}

.admin-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(40, 167, 69, 0.05), transparent);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.admin-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  border-color: rgba(40, 167, 69, 0.3) !important;
}

.admin-item:hover::before {
  opacity: 1;
}

.event-icon-admin {
  transition: transform 0.3s ease;
}

.admin-item:hover .event-icon-admin {
  transform: scale(1.15);
}

.event-meta p {
  margin-bottom: 0.25rem !important;
}

.event-meta i {
  width: 14px;
  text-align: center;
}

/* Mejoras específicas del calendario para administradores */
.admin-stats-card .card-body {
  padding: 1.5rem;
}

.admin-stats-card h3 {
  font-weight: 700;
  font-size: 2.5rem;
}

/* Animaciones de entrada para administradores */
@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(50px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.admin-stats-card {
  animation: slideInRight 0.6s ease forwards;
}

.admin-stats-card:nth-child(1) { animation-delay: 0.1s; }
.admin-stats-card:nth-child(2) { animation-delay: 0.2s; }
.admin-stats-card:nth-child(3) { animation-delay: 0.3s; }
.admin-stats-card:nth-child(4) { animation-delay: 0.4s; }

.admin-item {
  animation: slideInUp 0.5s ease forwards;
}

/* Responsive para administradores */
@media (max-width: 768px) {
  .admin-events-list {
    max-height: 350px;
  }
  
  .admin-item {
    margin-bottom: 1rem !important;
  }
  
  .event-icon-admin div {
    width: 35px !important;
    height: 35px !important;
    font-size: 0.8rem;
  }
  
  .admin-stats-card .card-body {
    padding: 1rem;
  }
  
  .admin-stats-card i {
    font-size: 2rem !important;
  }
  
  .admin-stats-card h3 {
    font-size: 2rem !important;
  }
}
</style>

<script>
$(document).ready(function() {
    console.log('Inicializando calendario...');
    
    // Actualizar fecha y hora actual para alumnos
    function updateDateTime() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        };
        const dateTimeElement = document.getElementById('currentDateTime');
        if (dateTimeElement) {
            dateTimeElement.textContent = now.toLocaleDateString('es-ES', options);
        }
    }
    
    updateDateTime();
    setInterval(updateDateTime, 60000); // Actualizar cada minuto
    
    // Datos de eventos desde Django
    var eventosData = {{ eventos_json|safe|default:"[]" }};
    console.log('Eventos cargados:', eventosData);
    
    // Configuración del calendario adaptada por tipo de usuario
    var calendarConfig = {
        locale: 'es',
        initialView: 'dayGridMonth',
        height: 600,
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        buttonText: {
            today: 'Hoy',
            month: 'Mes',
            week: 'Semana',
            list: 'Lista'
        },
        events: eventosData,
        eventClick: function(info) {
            var evento = info.event;
            var fechaFormateada = evento.start.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            var mensaje = `📅 ${evento.title}\n\n`;
            mensaje += `📆 Fecha: ${fechaFormateada}\n`;
            
            if (evento.start.getHours() !== 0 || evento.start.getMinutes() !== 0) {
                var horaInicio = evento.start.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                mensaje += `🕐 Hora: ${horaInicio}`;
                
                if (evento.end) {
                    var horaFin = evento.end.toLocaleTimeString('es-ES', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    mensaje += ` - ${horaFin}`;
                }
                mensaje += `\n`;
            }
            
            if (evento.extendedProps && evento.extendedProps.description) {
                mensaje += `\n📝 Descripción:\n${evento.extendedProps.description}`;
            }
            
            {% if user.perfil.tipo_usuario == 'administrador' or user.perfil.tipo_usuario == 'director' %}
            if (evento.extendedProps && evento.extendedProps.creado_por) {
                mensaje += `\n👤 Creado por: ${evento.extendedProps.creado_por}`;
            }
            {% endif %}
            
            alert(mensaje);
        },
        dateClick: function(info) {
            {% if puede_crear_eventos %}
            $('input[name="fecha"]').val(info.dateStr);
            $('#modalAgregarEvento').modal('show');
            {% else %}
            // Para usuarios sin permisos, mostrar información de la fecha
            var fechaSeleccionada = new Date(info.dateStr);
            var fechaFormateada = fechaSeleccionada.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            var eventosEnFecha = eventosData.filter(function(evento) {
                var fechaEvento = new Date(evento.start);
                return fechaEvento.toDateString() === fechaSeleccionada.toDateString();
            });
            
            if (eventosEnFecha.length > 0) {
                var mensaje = `📅 Eventos para ${fechaFormateada}:\n\n`;
                eventosEnFecha.forEach(function(evento, index) {
                    mensaje += `${index + 1}. ${evento.title}\n`;
                });
                alert(mensaje);
            } else {
                alert(`📅 ${fechaFormateada}\n\nNo hay eventos programados para esta fecha.`);
            }
            {% endif %}
        },
        eventDisplay: 'block',
        dayMaxEvents: {% if user.perfil.tipo_usuario == 'administrador' or user.perfil.tipo_usuario == 'director' %}5{% else %}3{% endif %},
        moreLinkClick: 'popover',
        eventMouseEnter: function(info) {
            info.el.style.transform = 'scale(1.05)';
            info.el.style.zIndex = '1000';
            info.el.style.cursor = 'pointer';
        },
        eventMouseLeave: function(info) {
            info.el.style.transform = 'scale(1)';
            info.el.style.zIndex = 'auto';
        }
    };
    
    // Inicializar FullCalendar
    var calendarEl = document.getElementById('calendar');
    
    if (calendarEl) {
        var calendar = new FullCalendar.Calendar(calendarEl, calendarConfig);
        calendar.render();
        console.log('Calendario renderizado');
        
        // Animación de entrada para el calendario
        setTimeout(function() {
            calendarEl.style.opacity = '0';
            calendarEl.style.transform = 'translateY(20px)';
            calendarEl.style.transition = 'all 0.6s ease';
            
            setTimeout(function() {
                calendarEl.style.opacity = '1';
                calendarEl.style.transform = 'translateY(0)';
            }, 100);
        }, 500);
        
    } else {
        console.error('Elemento calendar no encontrado');
    }
    
    // Animaciones para las tarjetas de estadísticas (solo para alumnos)
    {% if user.perfil.tipo_usuario == 'alumno' %}
    const statsCards = document.querySelectorAll('.stats-card');
    statsCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 150);
    });
    
    // Animaciones para los eventos de estudiantes
    const eventItems = document.querySelectorAll('.student-event-item');
    eventItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateX(-20px)';
        
        setTimeout(() => {
            item.style.transition = 'all 0.4s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateX(0)';
        }, 800 + (index * 100));
    });
    {% endif %}
    
    // Animaciones para administradores y directores
    {% if user.perfil.tipo_usuario == 'administrador' or user.perfil.tipo_usuario == 'director' %}
    const adminStatsCards = document.querySelectorAll('.admin-stats-card');
    adminStatsCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateX(50px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateX(0)';
        }, index * 150);
    });
    
    // Animaciones para los eventos de administradores
    const adminEventItems = document.querySelectorAll('.admin-item');
    adminEventItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            item.style.transition = 'all 0.5s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, 800 + (index * 100));
    });
    
    // Efectos adicionales para el panel administrativo
    const adminHeader = document.querySelector('.bg-white.p-4.rounded.shadow-sm');
    if (adminHeader) {
        adminHeader.style.opacity = '0';
        adminHeader.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
            adminHeader.style.transition = 'all 0.8s ease';
            adminHeader.style.opacity = '1';
            adminHeader.style.transform = 'translateY(0)';
        }, 200);
    }
    {% endif %}
    
    {% if puede_crear_eventos %}
    // Manejar formulario de agregar evento
    $('#formAgregarEvento').on('submit', function(e) {
        e.preventDefault();
        
        var formData = new FormData(this);
        var submitBtn = $(this).find('button[type="submit"]');
        var originalText = submitBtn.html();
        
        submitBtn.html('<i class="fa fa-spinner fa-spin"></i> Creando...').prop('disabled', true);
        
        $.ajax({
            url: window.location.href,
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(response) {
                if (response.success) {
                    alert('Evento creado exitosamente');
                    $('#modalAgregarEvento').modal('hide');
                    location.reload();
                } else {
                    alert('Error: ' + (response.error || 'Error desconocido'));
                }
            },
            error: function(xhr, status, error) {
                console.error('Error AJAX:', error);
                alert('Error de conexión. Inténtalo de nuevo.');
            },
            complete: function() {
                submitBtn.html(originalText).prop('disabled', false);
            }
        });
    });
    
    // Mostrar/ocultar cursos específicos
    $('input[name="dirigido_a"]').on('change', function() {
        if ($(this).val() === 'cursos_especificos') {
            $('#cursosEspecificos').show();
        } else {
            $('#cursosEspecificos').hide();
            $('#cursosEspecificos input[type="checkbox"]').prop('checked', false);
        }
    });
    
    // Limpiar formulario al cerrar modal
    $('#modalAgregarEvento').on('hidden.bs.modal', function() {
        $('#formAgregarEvento')[0].reset();
        $('input[name="dirigido_a"][value="todos"]').prop('checked', true);
        $('#cursosEspecificos').hide();
    });
    {% endif %}
});

{% if puede_crear_eventos %}
function eliminarEvento(eventoId, titulo) {
    if (confirm('¿Estás seguro de que deseas eliminar el evento "' + titulo + '"?')) {
        $.ajax({
            url: '/eventos/eliminar/' + eventoId + '/',
            type: 'POST',
            headers: {
                'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val(),
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(response) {
                if (response.success) {
                    alert('Evento eliminado correctamente');
                    location.reload();
                } else {
                    alert('Error: ' + (response.error || 'Error al eliminar'));
                }
            },
            error: function() {
                alert('Error de conexión');
            }
        });
    }
}
{% endif %}
</script>

{% endblock %}
